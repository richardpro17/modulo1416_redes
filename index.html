<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Examen CCNA 2 (SRWE) - Módulos 14-16</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap');

        :root {
            --primary-color: #007bff;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --light-color: #f8f9fa;
            --dark-color: #343a40;
            --border-color: #dee2e6;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--light-color);
            color: var(--dark-color);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        #quiz-container {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 900px; /* Un poco más ancho para la guía */
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        #quiz-header {
            padding: 20px 30px;
            background-color: var(--primary-color);
            color: white;
        }

        #quiz-header h1 {
            margin: 0;
            font-size: 1.8em;
        }
        
        #quiz-header p {
            margin: 5px 0 0;
            opacity: 0.9;
        }

        /* --- Estilos de la Guía de Navegación --- */
        #question-nav-panel {
            padding: 15px 30px;
            background-color: #f1f3f5;
            border-bottom: 1px solid var(--border-color);
            max-height: 150px;
            overflow-y: auto;
        }
        
        #nav-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
        }

        .nav-btn {
            width: 35px;
            height: 35px;
            border: 1px solid #ccc;
            border-radius: 5px;
            background-color: white;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.9em;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .nav-btn:hover { transform: scale(1.1); }
        .nav-btn.active { border: 2px solid var(--primary-color); box-shadow: 0 0 5px var(--primary-color); }
        .nav-btn.answered-draft { background-color: var(--warning-color); color: #333; border-color: #e0a800; }
        .nav-btn.correct { background-color: var(--success-color); color: white; border-color: #1e7e34; }
        .nav-btn.incorrect { background-color: var(--danger-color); color: white; border-color: #bd2130; }

        /* ---------------------------------------- */

        #question-area {
            padding: 30px;
            flex-grow: 1;
        }

        #question-counter {
            font-weight: 500;
            color: #6c757d;
            margin-bottom: 10px;
        }

        #question-text {
            font-size: 1.2em;
            font-weight: 500;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        #question-image {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 0 auto 20px auto;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        #options-container .option {
            display: block;
            background-color: #f1f3f5;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
        }

        #options-container .option:hover {
            border-color: var(--primary-color);
            background-color: #e9ecef;
        }

        #options-container .option.selected {
            background-color: #cfe2ff;
            border-color: var(--primary-color);
            font-weight: 500;
        }

        #options-container.disabled .option {
            cursor: not-allowed;
            opacity: 0.8;
        }
        
        /* Permitir ver qué seleccionaste aunque esté deshabilitado */
        #options-container.disabled .option.selected {
            opacity: 1; 
        }

        #options-container .option.correct {
            background-color: #d4edda;
            border-color: var(--success-color);
            color: #155724;
            font-weight: 500;
        }

        #options-container .option.incorrect {
            background-color: #f8d7da;
            border-color: var(--danger-color);
            color: #721c24;
            font-weight: 500;
        }

        #explanation-area {
            display: none;
            padding: 20px;
            margin-top: 20px;
            background-color: #eefbff;
            border-left: 5px solid var(--primary-color);
            border-radius: 5px;
        }

        #explanation-area h3 {
            margin-top: 0;
            color: var(--primary-color);
        }

        #controls {
            padding: 30px;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between; /* Separar botones */
            align-items: center;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 5px;
            font-size: 1em;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.2s;
            color: white;
        }

        #prev-btn { background-color: #6c757d; }
        #prev-btn:hover { background-color: #5a6268; }
        #prev-btn:disabled { background-color: #e2e6ea; cursor: not-allowed; color: #aaa; }

        #check-btn { background-color: var(--primary-color); }
        #check-btn:hover { background-color: #0056b3; }
        #check-btn:disabled { background-color: #a0c4ff; cursor: default; }

        #next-btn { background-color: #17a2b8; } /* Azul turquesa para Siguiente (neutro) */
        #next-btn:hover { background-color: #138496; }

        #finish-btn { background-color: var(--success-color); display: none; }
        #finish-btn:hover { background-color: #218838; }

        #final-screen {
            padding: 30px;
            text-align: center;
        }

        #final-score {
            font-size: 2.2em;
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        #restart-btn {
            background-color: var(--primary-color);
            color: white;
            margin-top: 30px;
        }

        #results-summary {
            text-align: left;
            margin-top: 20px;
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            padding: 10px;
        }

        .result-item { padding: 15px; border-bottom: 1px solid var(--border-color); }
        .result-item:last-child { border-bottom: none; }
        .result-question { font-weight: 700; }
        .user-answers, .correct-answers-summary { font-size: 0.9em; margin-left: 15px; }
        .user-answers span.correct-choice { color: var(--success-color); }
        .user-answers span.incorrect-choice { color: var(--danger-color); text-decoration: line-through; }
        .points { font-weight: 700; color: var(--primary-color); }
        code { font-family: 'Courier New', Courier, monospace; background-color: #e9ecef; padding: 2px 4px; border-radius: 4px; }
    </style>
</head>
<body>

    <div id="quiz-container">
        <div id="quiz-header">
            <h1>Examen CCNA 2 (SRWE)</h1>
            <p>Módulos 14 – 16: Conceptos de Enrutamiento y Enrutamiento Estático</p>
        </div>

        <div id="question-nav-panel">
            <div id="nav-grid"></div>
        </div>

        <div id="question-area">
            <p id="question-counter"></p>
            <p id="question-text"></p>
            <p id="instruction" style="color: #6c757d; font-style: italic;"></p>
            <div id="options-container"></div>
            <div id="explanation-area">
                <h3>Explicación</h3>
                <p id="explanation-text"></p>
            </div>
        </div>

        <div id="controls">
            <button id="prev-btn" class="btn">Anterior</button>
            <div>
                <button id="check-btn" class="btn">Verificar Respuesta</button>
                <button id="next-btn" class="btn">Siguiente</button>
                <button id="finish-btn" class="btn">Finalizar Examen</button>
            </div>
        </div>

        <div id="final-screen" style="display: none;">
            <h2 id="final-score"></h2>
            <p>Aquí está el resumen de tus resultados:</p>
            <div id="results-summary"></div>
            <button id="restart-btn" class="btn">Reiniciar Examen</button>
        </div>
    </div>

    <script>
        const questions = [
            {
                question: "Consulte la exhibición. ¿Qué hace el router con un paquete que tiene una dirección IP de destino 192.168.12.227?",
                image: "q1.jpg", 
                options: [
                    "Descarta el paquete.",
                    "Envía el paquete por la interfaz GigabitEthernet0/1.",
                    "Envía el paquete por la interfaz GigabitEthernet0/0.",
                    "Envía el paquete por la interfaz Serial0/0/0."
                ],
                answers: ["Envía el paquete por la interfaz Serial0/0/0."],
                explanation: "La red 192.168.12.224 no se encuentra en la tabla de routing y el router utiliza el gateway de último recurso (209.165.200.226). "
            },
            {
                question: "¿Qué sucede con una entrada de ruta estática en una tabla de routing cuando la interfaz de salida asociada con esa ruta pasa al estado inactivo?",
                options: [
                    "El router redirige automáticamente la ruta estática para utilizar otra interfaz.",
                    "La ruta estática permanece en la tabla porque se la definió como estática.",
                    "El router interroga a los vecinos en busca de una ruta de reemplazo.",
                    "La ruta estática se elimina de la tabla de routing."
                ],
                answers: ["La ruta estática se elimina de la tabla de routing."],
                explanation: "Cuando la interfaz asociada a la ruta estática deja de funcionar, el router elimina la ruta porque ya no es válida. "
            },
            {
                question: "¿Cuál es una característica de una ruta estática que coincide con todos los paquetes?",
                options: [
                    "Utiliza una dirección de red única para enviar varias rutas estáticas a una dirección de destino.",
                    "Está configurado con una distancia administrativa mayor que la del protocolo de routing dinámico original.",
                    "Respalda una ruta ya descubierta por un protocolo de routing dinámico.",
                    "Identifica la dirección IP del gateway al cual el router envía todos los paquetes IP para los que no tiene una ruta descubierta o estática."
                ],
                answers: ["Identifica la dirección IP del gateway al cual el router envía todos los paquetes IP para los que no tiene una ruta descubierta o estática."],
                explanation: "Una ruta estática predeterminada es aquella que coincide con todos los paquetes (0.0.0.0/0) y crea un gateway de último recurso. "
            },
            {
                question: "¿Qué ruta tendrá una menor distancia administrativa?",
                options: [
                    "una ruta recibida a través del protocolo de routing EIGRP",
                    "Una ruta recibida a través del protocolo de routing OSPF",
                    "Una ruta estática",
                    "Una red conectada directamente"
                ],
                answers: ["Una red conectada directamente"],
                explanation: "La ruta más creíble o la ruta con la menor distancia administrativa es la que se conecta directamente al router. "
            },
            {
                question: "¿Cuándo sería más beneficioso usar un protocolo de routing dinámico en lugar de un routing estático?",
                options: [
                    "En una red stub que tiene un único punto de salida.",
                    "En una red donde existen muchos cambios de topología.",
                    "En una organización donde los routers tienen problemas de rendimiento.",
                    "En una organización con una red más pequeña que no se espera que crezca en tamaño."
                ],
                answers: ["En una red donde existen muchos cambios de topología."],
                explanation: "Los protocolos de routing dinámico son adecuados para las redes más grandes y son más útiles en redes que crecen y cambian. "
            },
            {
                question: "Una la característica con el tipo de routing correspondiente. (Se refiere a: En general, se usa en las redes de rutas internas).",
                options: [
                    "Enrutamiento estático",
                    "Enrutamiento dinámico"
                ],
                answers: ["Enrutamiento estático"],
                explanation: "El enrutamiento estático se usa típicamente en redes stub (rutas internas). "
            },
            {
                question: "Un administrador de red configura la interfaz fa0/0 en el router R1 con el comando ip address 172.16.1.254 255.255.255.0 . Sin embargo, cuando el administrador emite el comando show ip route , en la tabla de routing no se muestra la red conectada directamente. ¿Cuál es la posible causa del problema?",
                options: [
                    "La máscara de subred para la dirección IPv4 es incorrecta.",
                    "No se envió ningún paquete con una red de destino 172.16.1.0 al R1.",
                    "Primero se debe guardar la configuración.",
                    "No se activó la interfaz fa0/0."
                ],
                answers: ["No se activó la interfaz fa0/0."],
                explanation: "Se agrega una red conectada directamente cuando la interfaz está configurada con una IP válida, está activada (no shutdown) y recibe señal portadora. "
            },
            {
                question: "Consulte el gráfico. ¿Qué comando se usaría en el router A para configurar una ruta estática que dirija el tráfico de la LAN A que está destinado a la LAN C?",
                image: "q8.jpg", 
                options: [
                    "A(config)# ip route 192.168.4.0 255.255.255.0 192.168.3.2",
                    "A(config)# ip route 192.168.3.0 255.255.255.0 192.168.3.1",
                    "A(config)# ip route 192.168.4.0 255.255.255.0 192.168.5.2",
                    "A(config)# ip route 192.168.3.2 255.255.255.0 192.168.4.0",
                    "A(config)# ip route 192.168.5.0 255.255.255.0 192.168.3.2"
                ],
                answers: ["A(config)# ip route 192.168.4.0 255.255.255.0 192.168.3.2"],
                explanation: "La red de destino en LAN C es 192.168.4.0 y la dirección de siguiente salto desde la perspectiva del router A es 192.168.3.2. "
            },
            {
                question: "¿En qué dos routers se debe configurar una ruta estática predeterminada? (Elija dos opciones.)",
                options: [
                    "Conexión del router perimetral al ISP.",
                    "El router que funciona como gateway de último recurso.",
                    "Cualquier router que ejecuta un IOS anterior a 12.0.",
                    "Cualquier router donde se necesita una ruta de respaldo al routing dinámico para obtener confiabilidad.",
                    "Conexión del router de rutas internas al resto de la red corporativa o de campus."
                ],
                answers: ["Conexión del router perimetral al ISP.", "Conexión del router de rutas internas al resto de la red corporativa o de campus."],
                explanation: "Funciona una ruta estática predeterminada en routers stub o routers perimetrales conectados a un ISP donde todo el tráfico se envía a un único destino. "
            },
            {
                question: "Considere el siguiente comando: ip route 192.168.10.0 255.255.255.0 10.10.10.2 5 . ¿Cómo un administrador probaría esta configuración?",
                options: [
                    "Haría ping de la red 192.168.10.0 a la dirección 10.10.10.2.",
                    "Apagaría manualmente la interfaz de router que se utiliza como ruta principal.",
                    "Eliminaría la ruta del gateway predeterminado en el router.",
                    "Haría ping a cualquier dirección válida en la red 192.168.10.0/24."
                ],
                answers: ["Apagaría manualmente la interfaz de router que se utiliza como ruta principal."],
                explanation: "Es una ruta flotante (AD 5). Solo aparece en la tabla si la ruta principal falla. Para probarla, se debe desactivar la ruta principal. "
            },
            {
                question: "Un administrador de redes emite el comando ipv6 route 2001:db8:acad:1::/32 gigabitethernet0/0 2001:db8:acad:6::1 100 en un router. ¿Qué distancia administrativa se asigna a esta ruta?",
                options: [
                    "32",
                    "100",
                    "1",
                    "0"
                ],
                answers: ["100"],
                explanation: "El 100 al final del comando especifica la distancia administrativa que se aplicará a la ruta. "
            },
            {
                question: "Consulte la ilustración. ¿Qué dos comandos cambiarán la dirección de siguiente salto para la red 10.0.0.0/8 de 172.16.40.2 a 192.168.1.2? (Elija dos opciones.)",
                image: "q12.jpg", 
                options: [
                    "A(config)# no network 10.0.0.0 255.0.0.0 172.16.40.2",
                    "A(config)# ip route 10.0.0.0 255.0.0.0 192.168.1.2",
                    "A(config)# no ip address 10.0.0.1 255.0.0.0 172.16.40.2",
                    "A(config)# ip route 10.0.0.0 255.0.0.0 s0/0/0",
                    "A(config)# no ip route 10.0.0.0 255.0.0.0 172.16.40.2"
                ],
                answers: ["A(config)# no ip route 10.0.0.0 255.0.0.0 172.16.40.2", "A(config)# ip route 10.0.0.0 255.0.0.0 192.168.1.2"],
                explanation: "Se debe eliminar la ruta anterior con 'no ip route' y agregar la nueva con la IP de siguiente salto correcta. "
            },
            {
                question: "Consulte la ilustración. ¿Qué comando de ruta estática predeterminada permitiría que R1 potencialmente llegue a todas las redes desconocidas en Internet?",
                image: "q13.jpg", 
                options: [
                    "R1(config)# ipv6 route ::/0 G0/0 fe80::2",
                    "R1(config)# ipv6 route 2001:db8:32::/64 G0/0",
                    "R1(config)# ipv6 route ::/0 G0/1 fe80::2",
                    "R1(config)# ipv6 route 2001:db8:32::/64 G0/1 fe80::2"
                ],
                answers: ["R1(config)# ipv6 route ::/0 G0/1 fe80::2"],
                explanation: "La ruta predeterminada IPv6 es ::/0. Debe salir por G0/1 hacia la link-local de R2 (fe80::2). "
            },
            {
                question: "Consulte la ilustración. ¿Qué tipo de ruta estática IPv6 se configuró en la ilustración?",
                image: "q14.jpg", 
                options: [
                    "ruta estática recursiva",
                    "ruta estática flotante",
                    "Ruta estática conectada directamente",
                    "Ruta estática completamente especificada"
                ],
                answers: ["ruta estática recursiva"],
                explanation: "La ruta proporciona solo la dirección del siguiente salto, lo que obliga al router a realizar una búsqueda recursiva para encontrar la interfaz de salida. "
            },
            {
                question: "Consulte la exhibición. El ingeniero de red para la compañía que se muestra desea usar la conexión ISP principal para toda la conectividad externa. La conexión ISP de respaldo se usa solamente si la conexión ISP principal falla. ¿Qué conjunto de comandos se usaría para lograr esto?",
                image: "q15.jpg", 
                options: [
                    "ip route 198.133.219.24 255.255.255.252 ip route 64.100.210.80 255.255.255.252",
                    "ip route 198.133.219.24 255.255.255.252 ip route 64.100.210.80 255.255.255.252 10",
                    "ip route 0.0.0.0 0.0.0.0 s0/0/0 ip route 0.0.0.0 0.0.0.0 s0/1/0 10",
                    "ip route 0.0.0.0 0.0.0.0 s0/0/0 ip route 0.0.0.0 0.0.0.0 s0/1/0"
                ],
                answers: ["ip route 0.0.0.0 0.0.0.0 s0/0/0 ip route 0.0.0.0 0.0.0.0 s0/1/0 10"],
                explanation: "La ruta principal (s0/0/0) tiene AD por defecto (1). La de respaldo (s0/1/0) debe tener una AD mayor (10) para ser flotante. "
            },
            {
                question: "Consulte la exhibición. La compañía pequeña que se muestra usa routing estático. Los usuarios en la LAN del R2 informaron un problema de conectividad. ¿Cuál es el problema?",
                image: "q16.jpg", 
                options: [
                    "El R2 necesita una ruta estática a las LAN del R1.",
                    "El R2 necesita una ruta estática a Internet.",
                    "El R1 necesita una ruta predeterminada al R2.",
                    "El R1 y el R2 deben usar un protocolo de routing dinámico.",
                    "El R1 necesita una ruta estática a las LAN del R2."
                ],
                answers: ["El R1 necesita una ruta estática a las LAN del R2."],
                explanation: "R1 tiene ruta por defecto a Internet, pero no sabe cómo llegar a la red interna 10.0.60.0 (R2) y enviará ese tráfico al ISP por error. "
            },
            {
                question: "Consulte la ilustración. Un administrador intenta instalar una ruta estática IPv6 en el router R1 para llegar a la red conectada al router R2. Después de introducir el comando de ruta estática, la conectividad a la red sigue fallando. ¿Qué error se cometió en la configuración de la ruta estática?",
                image: "q17.jpg", 
                options: [
                    "El prefijo de red es incorrecto.",
                    "La dirección de siguiente salto es incorrecta.",
                    "La red de destino es incorrecta.",
                    "La interfaz es incorrecta."
                ],
                answers: ["La interfaz es incorrecta."],
                explanation: "La interfaz especificada en la ruta estática debe ser la interfaz de salida del router local (R1), que es s0/0/0, no s0/0/1. "
            },
            {
                question: "Consulte la ilustración. ¿Cómo se instaló la ruta 2001:DB8:CAFE:4::1/128 del host en la tabla de routing?",
                image: "q18.jpg", 
                options: [
                    "La ruta se instaló automáticamente cuando se configuró una dirección IP en una interfaz activa.",
                    "Un administrador introdujo la ruta de forma manual.",
                    "El router R1 creó de forma dinámica la ruta.",
                    "La ruta se aprendió de forma dinámica de otro router."
                ],
                answers: ["Un administrador introdujo la ruta de forma manual."],
                explanation: "La ruta está marcada con 'S' (Static), lo que indica que fue configurada manualmente por un administrador. "
            },
            {
                question: "Consulte la ilustración. El HostA intenta contactarse con el ServidorB. ¿Cuáles son las dos afirmaciones que describen correctamente el direccionamiento que el HostA generará en el proceso? (Elija dos).",
                image: "q19.jpg", 
                options: [
                    "Un paquete con la dirección IP de destino del ServidorB.",
                    "Un trama con la dirección MAC de destino del RouterA.",
                    "Un paquete con la dirección IP de destino del RouterB.",
                    "Un trama con la dirección MAC de destino del SwitchA.",
                    "Un trama con la dirección MAC de destino del ServidorB.",
                    "Un paquete con la dirección IP de destino del RouterA."
                ],
                answers: ["Un paquete con la dirección IP de destino del ServidorB.", "Un trama con la dirección MAC de destino del RouterA."],
                explanation: "El paquete IP lleva la IP del destino final (ServidorB). La trama Ethernet lleva la MAC del gateway predeterminado (RouterA). "
            },
            {
                question: "Consulte la ilustración. El ping del R1 a 10.1.1.2 se realiza correctamente, pero los pings del R1 a cualquier dirección en la red 192.168.2.0 fallan. ¿Cuál es la causa del problema?",
                image: "q20.jpg", 
                options: [
                    "No se configuró una ruta predeterminada en el R1.",
                    "La interfaz serial entre los dos routers está desactivada.",
                    "No hay gateway de último recurso en el R1.",
                    "La ruta estática para 192.168.2.0 está configurada de manera incorrecta."
                ],
                answers: ["La ruta estática para 192.168.2.0 está configurada de manera incorrecta."],
                explanation: "La tabla muestra 'S 192.168.2.0 [1/0] via 192.168.3.0'. La dirección de siguiente salto parece incorrecta; debería ser 10.1.1.2. "
            },
            {
                question: "Consulte la ilustración. Un administrador está intentando instalar una ruta estática predeterminada en el router R1 para llegar a la red del sitio B en el router R2. Después de ingresar el comando static route, la ruta todavía no aparece en la tabla de ruteo del router R1. ¿Qué impide que la ruta se instale en la tabla de enrutamiento?",
                image: "q21.jpg", 
                options: [
                    "La máscara de red es incorrecta.",
                    "La red de destino es incorrecta.",
                    "La dirección del siguiente salto es incorrecta.",
                    "Falta la interfaz de salida."
                ],
                answers: ["La dirección del siguiente salto es incorrecta."],
                explanation: "El comando usa '172.16.2.0' como siguiente salto. La dirección correcta debería ser la IP de la interfaz serial de R2 (209.165.202.130). "
            },
            {
                question: "Consulte la ilustración. ¿Qué solución de routing permitirá que la PC A y la PC B accedan a Internet con la cantidad mínima de utilización de ancho de banda de red y CPU del router?",
                image: "q22.jpg", 
                options: [
                    "Configurar una ruta estática desde el R1 hasta el perímetro y una ruta dinámica desde el perímetro hasta el R1.",
                    "Configurar una ruta estática predeterminada desde el R1 hasta el perímetro, una ruta predeterminada desde el perímetro hasta Internet y una ruta estática desde el perímetro hasta el R1.",
                    "Configurar una ruta dinámica desde el R1 hasta el perímetro y una ruta estática desde el perímetro hasta el R1.",
                    "Configurar un protocolo de routing dinámico entre el R1 y el perímetro, y anunciar todas las rutas."
                ],
                answers: ["Configurar una ruta estática predeterminada desde el R1 hasta el perímetro, una ruta predeterminada desde el perímetro hasta Internet y una ruta estática desde el perímetro hasta el R1."],
                explanation: "Usar rutas estáticas y por defecto consume menos recursos (CPU/ancho de banda) que un protocolo dinámico. "
            },
            {
                question: "Consulte la ilustración. ¿Qué ocurrirá después de que el administrador de TI introduzca la nueva ruta estática?",
                image: "q23.jpg", 
                options: [
                    "La ruta estática de 172.16.1.0 se agregará a las rutas existentes en la tabla de routing.",
                    "La ruta predeterminada 0.0.0.0 se reemplazará por la ruta estática 172.16.1.0.",
                    "La ruta 172.16.1.0 aprendida de RIP se reemplazará por la ruta estática 172.16.1.0.",
                    "La ruta estática 172.16.1.0 se introducirá en running-config, pero no se mostrará en la tabla de routing."
                ],
                answers: ["La ruta 172.16.1.0 aprendida de RIP se reemplazará por la ruta estática 172.16.1.0."],
                explanation: "La ruta estática tiene una Distancia Administrativa (1) menor que RIP (120), por lo que la reemplazará en la tabla de routing. "
            },
            {
                question: "¿Qué dos datos se necesitan en una ruta estática completamente especificada para eliminar las búsquedas recursivas? (Elija dos opciones.)",
                options: [
                    "La distancia administrativa para la red de destino",
                    "La dirección IP del vecino de siguiente salto",
                    "La ID de interfaz de la interfaz de salida",
                    "La ID de interfaz del vecino de siguiente salto",
                    "La dirección IP de la interfaz de salida"
                ],
                answers: ["La dirección IP del vecino de siguiente salto", "La ID de interfaz de la interfaz de salida"],
                explanation: "Una ruta completamente especificada incluye tanto la interfaz de salida como la IP del siguiente salto para evitar recursión. "
            },
            {
                question: "Consulte la ilustración. ¿Qué comando configurará correctamente una ruta estática IPv6 en el router R2, que permitirá que el tráfico de la PC2 llegue a la PC1 sin búsquedas recurrentes del router R2?",
                image: "q25.jpg", 
                options: [
                    "R2(config)# ipv6 route 2001:db8:10:12::/64 2001:db8:32::1",
                    "R2(config)# ipv6 route 2001:db8:10:12::/64 S0/0/0",
                    "R2(config)# ipv6 route 2001:db8:10:12::/64 S0/0/1",
                    "R2(config)# ipv6 route ::/0 2001:db8:32::1"
                ],
                answers: ["R2(config)# ipv6 route 2001:db8:10:12::/64 S0/0/0"],
                explanation: "Usar la interfaz de salida (S0/0/0) hace que la ruta no sea recursiva. "
            },
            {
                question: "Consulte la ilustración. ¿Qué ruta estática introduciría un técnico de TI para crear una ruta de respaldo a la red 172.16.1.0 que solo se utiliza si la ruta principal aprendida a través de RIP falla?",
                image: "q26.jpg", 
                options: [
                    "ip route 172.16.1.0 255.255.255.0 s0/0/0 111",
                    "ip route 172.16.1.0 255.255.255.0 s0/0/0",
                    "ip route 172.16.1.0 255.255.255.0 s0/0/0 121",
                    "ip route 172.16.1.0 255.255.255.0 s0/0/0 91"
                ],
                answers: ["ip route 172.16.1.0 255.255.255.0 s0/0/0 121"],
                explanation: "Para ser una ruta de respaldo (flotante) a RIP (AD 120), la estática debe tener una AD mayor, por ejemplo 121. "
            },
            {
                question: "Abra la actividad de PT. Realice las tareas en las instrucciones de la actividad y luego responda la pregunta. Un usuario informa que PC0 no puede visitar el servidor web www.server.com . Ejecute el procedimiento de solución de problemas de configuración de red para identificar el problema. ¿Cuál es la causa del problema?",
                image: "q27.jpg", 
                options: [
                    "Una interfaz serial en Branch está configurada incorrectamente.",
                    "La frecuencia de reloj en uno de los enlaces seriales está configurada incorrectamente.",
                    "La dirección del servidor DNS en PC0 está configurada incorrectamente.",
                    "El routing entre HQ y Branch está configurado incorrectamente."
                ],
                answers: ["El routing entre HQ y Branch está configurado incorrectamente."],
                explanation: "Para comunicación remota, ambos routers deben tener configurado el enrutamiento correctamente. "
            },
            {
                question: "¿Qué utiliza el router R1 como dirección MAC de destino al crear la trama que irá del R1 al servidor B?",
                image: "q28.jpg", 
                options: [
                    "Si la dirección MAC de destino que corresponde a la dirección IPv4 no aparece en la caché ARP, R1 envía una solicitud de ARP.",
                    "El paquete se encapsula en una trama PPP, y R1 agrega la dirección de destino de PPP a la trama.",
                    "El R1 deja el campo en blanco y reenvía los datos a la PC.",
                    "El R1 utiliza la dirección MAC de destino del S1."
                ],
                answers: ["Si la dirección MAC de destino que corresponde a la dirección IPv4 no aparece en la caché ARP, R1 envía una solicitud de ARP."],
                explanation: "R1 necesita la MAC del destino (Servidor B). Si no está en su caché ARP, envía una solicitud ARP para obtenerla. "
            },
            {
                question: "¿Cuáles son las ventajas del enrutamiento estático en comparación con el enrutamiento dinámico? (Elija dos).",
                options: [
                    "El routing estático es más seguro porque no envía anuncios a través de la red.",
                    "El routing estático escala bien con las redes en expansión.",
                    "El routing estático requiere muy poco conocimiento sobre la red para realizar una implementación adecuada.",
                    "El routing estático usa menos recursos del router que el routing dinámico.",
                    "El routing estático es relativamente fácil de configurar para las redes grandes."
                ],
                answers: ["El routing estático es más seguro porque no envía anuncios a través de la red.", "El routing estático usa menos recursos del router que el routing dinámico."],
                explanation: "El routing estático es más seguro (sin anuncios) y consume menos CPU/RAM, pero no escala bien. "
            },
            {
                question: "¿Qué ruta se utiliza para reenviar un paquete con una dirección IP de origen 192.168.10.1 y una dirección IP de destino 10.1.1.1?",
                options: [
                    "S* 0.0.0.0/0 [1/0] via 172.16.1.1",
                    "S 10.1.0.0/16 is directly connected, GigabitEthernet0/0",
                    "O 10.1.1.0/24 [110/65] via 192.168.200.2, 0:01:20, Serial0/1/0",
                    "C 192.168.10.0/30 is directly connected, GigabitEthernet0/1"
                ],
                answers: ["O 10.1.1.0/24 [110/65] via 192.168.200.2, 0:01:20, Serial0/1/0"],
                explanation: "El router usa la coincidencia más larga (longest prefix match). /24 es más específico que /16 o /0 para la IP 10.1.1.1. "
            },
            {
                question: "¿Qué valor de una tabla de enrutamiento representa la fiabilidad y es utilizado por el router para determinar qué ruta instalar en la tabla de enrutamiento cuando hay varias rutas hacia el mismo destino?",
                options: [
                    "Protocolo de routing",
                    "distancia administrativa",
                    "métrica",
                    "interfaz de salida"
                ],
                answers: ["distancia administrativa"],
                explanation: "La distancia administrativa representa la confiabilidad de una ruta. Menor valor es mejor. "
            },
            {
                question: "Consulte la ilustración. Esta red tiene dos conexiones al ISP, una a través del router C y otra a través del router B. El enlace serial entre el router A y el router C admite EIGRP, y es el enlace principal a Internet. Si el enlace principal falla, el administrador necesita una ruta estática flotante que evita las búsquedas recurrentes de rutas y cualquier problema posible de siguiente salto causado por la naturaleza de acceso múltiple del segmento Ethernet con el router B. ¿Qué debe configurar el administrador?",
                image: "q32.jpg", 
                options: [
                    "Cree una ruta estática que apunte a 10.1.1.1 con una AD de 95.",
                    "Cree una ruta estática completamente especificada que apunte a Fa0/0 con una AD de 95.",
                    "Cree una ruta estática que apunte a 10.1.1.1 con una AD de 1.",
                    "Cree una ruta estática completamente especificada que apunte a Fa0/0 con una AD de 1.",
                    "Crear una ruta estática que apunte a Fa0/0 con una AD de 1."
                ],
                answers: ["Cree una ruta estática completamente especificada que apunte a Fa0/0 con una AD de 95."],
                explanation: "Debe ser >90 (EIGRP) y ser completamente especificada (interfaz + IP) por ser un enlace Ethernet. "
            },
            {
                question: "¿Qué combinación del prefijo de red y la longitud de este se utiliza para crear una ruta estática predeterminada que coincida con cualquier destino IPv6?",
                options: [
                    "::/128",
                    "FFFF::/128",
                    "::1/64",
                    "::/0"
                ],
                answers: ["::/0"],
                explanation: "La ruta estática predeterminada para IPv6 se expresa como ::/0. "
            },
            {
                question: "Consulte la ilustración. La tabla de routing para el R2 es la siguiente: (Ver imagen). ¿Qué hará el router R2 con un paquete destinado a 192.168.10.129?",
                image: "q34.jpg", 
				image: "ej1.jpg",
                options: [
                    "enviar el paquete interface Serial0/0/1",
                    "Enviará el paquete por la interfaz FastEthernet0/0.",
                    "enviar el paquete interface Serial0/0/0",
                    "descartará el paquete"
                ],
                answers: ["enviar el paquete interface Serial0/0/1"],
                explanation: "La ruta estática para .128 apunta a 10.0.0.6. Esta IP está conectada a Serial0/0/1. "
            },
            {
                question: "¿Qué característica completa la siguiente declaración?Cuando se configura una ruta estática IPv6, como ruta de respaldo a una ruta estática en la tabla de enrutamiento, el comando “distance” se usa con…",
                options: [
                    "la dirección del siguiente salto de dos diferentes routers adyacentes.",
                    "una distancia administrativa de 2.",
                    "una ruta de host de destino con un prefijo /128.",
                    "el comando “show ipv6 route static”."
                ],
                answers: ["una distancia administrativa de 2."],
                explanation: "Para crear una ruta de respaldo (flotante), se configura con una distancia administrativa mayor a la principal (ej. 2 vs 1). "
            },
            {
                question: "Consulte la ilustración. El router de sucursal tiene una relación de vecino OSPF con el router HQ a través de la red 198.51.0.4/30. El enlace de red 198.51.0.8/30 debe servir como copia de seguridad cuando el enlace OSPF se desactiva. El comando flotante static route ip route 0.0.0.0 0.0.0.0 S0/1/1 100 se emitió en Branch y ahora el tráfico está utilizando el enlace de copia de seguridad incluso cuando el enlace OSPF está activo y funcionando. ¿Qué cambio se debe realizar en el comando static route para que el tráfico sólo utilice el enlace OSPF cuando esté activo?",
                image: "q36.jpg", 
                options: [
                    "Add the next hop neighbor address of 198.51.0.8.",
                    "Cambie la distancia administrativa a 1.",
                    "Cambie la red de destino a 198.51.0.5.",
                    "Cambie la distancia administrativa a 120."
                ],
                answers: ["Cambie la distancia administrativa a 120."],
                explanation: "La AD debe ser mayor que OSPF (110). 100 es menor, por eso se prefiere. Cambiar a 120 soluciona esto. "
            },
            {
                question: "Consulte la exposición. ¿Qué interfaz será la interfaz de salida para reenviar un paquete de datos que tenga la dirección IP de destino 10.3.86.2?",
                image:"ej2.jpg",
				options: [
                    "Serial0/0/0",
                    "GigabitEthernet0/1",
                    "Serial0/0/1",
                    "GigabitEthernet0/0"
                ],
                answers: ["Serial0/0/0"],
                explanation: "10.3.86.2 pertenece a 10.3.86.0/26, accesible vía 10.3.2.1, que está conectada a Serial0/0/0. "
            },
            {
                question: "Consulte la ilustración. La PC A envía una solicitud al servidor B. ¿Qué dirección IPv4 se utiliza en el campo de destino del paquete cuando el paquete sale de la PC A?",
                image: "q38.jpg", 
                options: [
                    "192.168.10.1",
                    "192.168.12.16",
                    "192.168.10.10",
                    "192.168.11.1"
                ],
                answers: ["192.168.12.16"],
                explanation: "La dirección IP de destino no cambia en el trayecto; es la IP del Servidor B. "
            },
            {
                question: "Consulte la ilustración. ¿Cuál es el valor de la distancia administrativa de la ruta para que el router R1 se comunique con la dirección IPv6 de destino 2001:DB8:CAFE:4::A?",
                image: "q39.jpg", 
                options: [
                    "110",
                    "120",
                    "1",
                    "4"
                ],
                answers: ["120"],
                explanation: "La tabla muestra 'R' (RIP) para la red, y RIP tiene una AD de 120. "
            },
            {
                question: "¿Cuál es una característica de una ruta estática flotante?",
                options: [
                    "Cuando se configura, crea una puerta de enlace de último recurso.",
                    "Es simplemente una ruta estática con 0.0.0.0/0 como la dirección IPv4 de destino.",
                    "Se utiliza para proporcionar equilibrio de carga entre rutas estáticas.",
                    "Está configurado con una distancia administrativa mayor que la del protocolo de routing dinámico original."
                ],
                answers: ["Está configurado con una distancia administrativa mayor que la del protocolo de routing dinámico original."],
                explanation: "Las rutas flotantes son de respaldo y deben tener una AD mayor que la ruta principal para no ser preferidas mientras la principal funcione. "
            },
            {
                question: "Consulte la ilustración. ¿Qué conjunto de comandos configurará rutas estáticas que permitirán a los routers Park y Alta a) reenviar paquetes a cada LAN y b) dirigir todo el tráfico a Internet?",
                image: "q41.jpg", 
                options: [
                    "Parque (config) # ruta ip 0.0.0.0 0.0.0 192.168.14.1Alta (config) # ruta ip 10.0.234.0 255.255.0 192.168.14.2Alta (config) # ruta ip 0.0.0.0 0.0.0 s0/0/0",
                    "Parque (config) # ruta ip 172.16.67.0 255.255.255.0 192.168.14.1Alta (config) # ruta ip 10.0.234.0 255.255.0 192.168.14.2Alta (config) # ruta ip 0.0.0.0 0.0.0 s0/0/1",
                    "Parque (config) # ruta ip 172.16.67.0 255.255.255.0 192.168.14.1Parque (config) # ruta ip 0.0.0.0 0.0.0 192.168.14.1Alta (config) # ruta ip 10.0.234.0 255.255.255.0 192.168.14.2",
                    "Parque (config) # ruta ip 0.0.0.0 0.0.0 192.168.14.1Alta (config) # ruta ip 10.0.234.0 255.255.0 192.168.14.2Alta (config) # ruta ip 198.18.222.0 255.255.255.255 s0/0/0"
                ],
                answers: ["Parque (config) # ruta ip 0.0.0.0 0.0.0 192.168.14.1Alta (config) # ruta ip 10.0.234.0 255.255.0 192.168.14.2Alta (config) # ruta ip 0.0.0.0 0.0.0 s0/0/0"],
                explanation: "Park necesita una ruta por defecto hacia Alta. Alta necesita una estática hacia la LAN de Park y una por defecto hacia Internet. "
            },
            {
                question: "Considere el siguiente comando: ip route 192.168.10.0 255.255.255.0 10.10.10.2 5. ¿Qué ruta debería dejar de funcionar para que la ruta estática aparezca en la tabla de routing?",
                options: [
                    "Una ruta estática a la red 192.168.10.0/24.",
                    "Una ruta aprendida por EIGRP a la red 192.168.10.0/24.",
                    "Una ruta aprendida por OSPF a la red 192.168.10.0/24.",
                    "Una ruta predeterminada."
                ],
                answers: ["Una ruta estática a la red 192.168.10.0/24."],
                explanation: "Esta ruta tiene AD 5 (flotante). Solo aparecerá si la ruta estática principal (AD 1 por defecto) deja de funcionar. "
            },
            {
                question: "Un router usó el protocolo OSPF para descubrir una ruta a la red 172.16.32.0/19. ¿Qué comando implementa una ruta estática flotante de respaldo para esta red?",
                options: [
                    "ip route 172.16.32.0 255.255.0.0 S0/0/0 100",
                    "ip route 172.16.0.0 255.255.224.0 S0/0/0 100",
                    "ip route 172.16.0.0 255.255.240.0 S0/0/0 200",
                    "ip route 172.16.32.0 255.255.224.0 S0/0/0 200"
                ],
                answers: ["ip route 172.16.32.0 255.255.224.0 S0/0/0 200"],
                explanation: "La AD debe ser > 110 (OSPF). La máscara /19 es 255.255.224.0. La opción con AD 200 es correcta. "
            },
            {
                question: "¿Qué característica completa la siguiente declaración? Cuando se configura una ruta estática IPv6, la dirección del siguiente salto puede ser…",
                options: [
                    "una dirección de enlace local IPv6 en el router adyacente.",
                    "el tipo de interfaz y el numero de interfaz",
                    "el comando “show ipv6 route static”.",
                    "una ruta de host de destino con un prefijo /128."
                ],
                answers: ["una dirección de enlace local IPv6 en el router adyacente."],
                explanation: "Se puede usar la dirección link-local del router adyacente como siguiente salto. "
            },
            {
                question: "Consulte la exhibición. ¿Qué comando se utilizaría para configurar una ruta estática en el R1, a fin de que el tráfico de ambas LAN pueda llegar a la red remota 2001:db8:1:4::/64?",
                image: "q45.jpg", 
                options: [
                    "ipv6 route 2001:db8:1::/65 2001:db8:1:3::1",
                    "ipv6 route 2001:db8:1:4::/64 2001:db8:1:3::2",
                    "ipv6 route ::/0 serial0/0/0",
                    "ipv6 route 2001:db8:1:4::/64 2001:db8:1:3::1"
                ],
                answers: ["ipv6 route 2001:db8:1:4::/64 2001:db8:1:3::2"],
                explanation: "El destino es 2001:db8:1:4::/64. El siguiente salto es la IP de R2 (2001:db8:1:3::2). "
            },
            {
                question: "Consulte la imagen. ¿Qué interfaz será la interfaz de salida para reenviar un paquete de datos que tenga la dirección IP de destino 172.18.109.152?",
                image: "q46.jpg",
				options: [
                    "Gateway of last resort is not set",
                    "Serial0/0/0",
                    "Serial0/0/1",
                    "GigabitEthernet0/1",
                    "GigabitEthernet0/0"
                ],
                answers: ["Serial0/0/0"],
                explanation: ".152 cae en la subred .128/26. La ruta es vía 172.18.32.1, conectada a Serial0/0/0. "
            },
            {
                question: "Consulte la imagen. ¿Qué interfaz será la interfaz de salida para reenviar un paquete de datos que tenga la dirección IP de destino 192.168.71.52?",
                image: "q47.jpg",
				options: [
                    "Serial0/0/0",
                    "El paquete tomará la puerta de entrada de último recurso.",
                    "GigabitEthernet0/1",
                    "Ninguno, el paquete se descartará."
                ],
                answers: ["Serial0/0/0"],
                explanation: "Coincide con la estática 'S 192.168.71.0/26 via 192.168.70.1'. La IP .1 está en Serial0/0/0. "
            },
            {
                question: "¿Qué característica completa la siguiente declaración? Cuando se configura una ruta estática IPv6, la instalación de la ruta se puede verificar con…",
                options: [
                    "una distancia administrativa de 2.",
                    "el comando “show ipv6 route static”.",
                    "el tipo de interfaz y el numero de interfaz",
                    "una ruta de host de destino con un prefijo /128."
                ],
                answers: ["el comando “show ipv6 route static”."],
                explanation: "Este comando filtra y muestra solo las rutas estáticas IPv6 instaladas. "
            },
            {
                question: "Considere el siguiente comando: ip route 192.168.10.0 255.255.255.0 10.10.10.2 5 . ¿Qué significa el 5 al final del comando?",
                options: [
                    "métrica",
                    "distancia administrativa",
                    "Interfaz de salida",
                    "número máximo de saltos a la red 192.168.10.0/24"
                ],
                answers: ["distancia administrativa"],
                explanation: "El número al final del comando 'ip route' especifica la distancia administrativa. "
            },
            {
                question: "Consulte la imagen. ¿Cual interfaz será la interfaz de salida para reenviar un paquete de datos que tenga la dirección IP de destino 10.55.99.78?",
                image: "q50.jpg",
				options: [
                    "GigabitEthernet0/0",
                    "Serial0/0/0",
                    "GigabitEthernet0/1",
                    "Serial0/0/1"
                ],
                answers: ["Serial0/0/1"],
                explanation: ".78 está en la subred .64/26. Vía 10.55.18.6, que está conectada a Serial0/0/1. "
            },
            {
                question: "¿Qué característica completa la siguiente declaración?Cuando se configura una ruta estática IPv6, primero es necesario configurar…",
                options: [
                    "una distancia administrativa de 2.",
                    "una dirección de enlace local IPv6 en el router adyacente.",
                    "el comando “ipv6 unicast-routing”.",
                    "la dirección del siguiente salto de dos diferentes routers adyacentes."
                ],
                answers: ["el comando “ipv6 unicast-routing”."],
                explanation: "Es necesario habilitar el enrutamiento IPv6 globalmente antes de configurar rutas. "
            },
            {
                question: "¿Qué característica completa la siguiente declaración?Cuando se configura una ruta estática IPv6, es posible que se use la misma dirección local de enlace IPv6 para…",
                options: [
                    "el comando “ipv6 unicast-routing”.",
                    "una distancia administrativa de 2.",
                    "la dirección del siguiente salto de dos diferentes routers adyacentes.",
                    "una ruta de host de destino con un prefijo /128."
                ],
                answers: ["la dirección del siguiente salto de dos diferentes routers adyacentes."],
                explanation: "Las direcciones link-local son únicas solo dentro de un enlace, por lo que la misma dirección puede repetirse en enlaces diferentes. "
            },
            {
                question: "Consulte la exposición. ¿Qué interfaz será la interfaz de salida para reenviar un paquete de datos que tenga la dirección IP de destino 172.25.128.244?",
                image: "q53.jpg",
				options: [
                    "Serial0/0/1",
                    "GigabitEthernet0/0",
                    "GigabitEthernet0/1",
                    "Ninguno, el paquete se descartará."
                ],
                answers: ["GigabitEthernet0/1"],
                explanation: ".244 cae en el rango .224/27, que está directamente conectado a GigabitEthernet0/1. "
            },
            {
                question: "Consulte la imgen. ¿Qué interfaz será la interfaz de salida para reenviar un paquete de datos que tenga la dirección IP de destino 192.168.139.244?",
                image: "q54.jpg",
				options: [
                    "Serial0/0/0",
                    "GigabitEthernet0/0",
                    "GigabitEthernet0/1",
                    "Ninguno, el paquete se descartará."
                ],
                answers: ["GigabitEthernet0/1"],
                explanation: ".244 cae en la subred .224/27, conectada directamente a GigabitEthernet0/1. "
            }
        ];

        // --- Elementos del DOM ---
        const questionArea = document.getElementById('question-area');
        const questionCounter = document.getElementById('question-counter');
        const instructionText = document.getElementById('instruction');
        const questionText = document.getElementById('question-text');
        const optionsContainer = document.getElementById('options-container');
        const explanationArea = document.getElementById('explanation-area');
        const explanationText = document.getElementById('explanation-text');
        
        const checkBtn = document.getElementById('check-btn');
        const nextBtn = document.getElementById('next-btn');
        const prevBtn = document.getElementById('prev-btn');
        const finishBtn = document.getElementById('finish-btn');
        const navGrid = document.getElementById('nav-grid');

        const finalScreen = document.getElementById('final-screen');
        const finalScore = document.getElementById('final-score');
        const resultsSummary = document.getElementById('results-summary');
        const restartBtn = document.getElementById('restart-btn');

        let shuffledQuestions = [];
        let currentQuestionIndex = 0;
        
        // Estado del usuario por cada pregunta: { selected: [], isChecked: boolean, isCorrect: boolean }
        let userAnswersState = [];

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function startQuiz() {
            shuffledQuestions = [...questions];
            shuffleArray(shuffledQuestions);
            
            // Inicializar estado vacío para todas las preguntas
            userAnswersState = shuffledQuestions.map(() => ({
                selected: [],
                isChecked: false,
                isCorrect: null
            }));

            currentQuestionIndex = 0;
            questionArea.style.display = 'block';
            document.getElementById('controls').style.display = 'flex';
            document.getElementById('question-nav-panel').style.display = 'block';
            finalScreen.style.display = 'none';
            
            createNavButtons();
            displayQuestion();
        }

        function createNavButtons() {
            navGrid.innerHTML = '';
            shuffledQuestions.forEach((_, index) => {
                const btn = document.createElement('button');
                btn.classList.add('nav-btn');
                btn.textContent = index + 1;
                btn.id = `nav-btn-${index}`;
                btn.onclick = () => goToQuestion(index);
                navGrid.appendChild(btn);
            });
            updateNavStyles();
        }

        function updateNavStyles() {
            userAnswersState.forEach((state, index) => {
                const btn = document.getElementById(`nav-btn-${index}`);
                btn.className = 'nav-btn'; // Reset
                if (index === currentQuestionIndex) {
                    btn.classList.add('active');
                }
                
                if (state.isChecked) {
                    if (state.isCorrect) btn.classList.add('correct');
                    else btn.classList.add('incorrect');
                } else if (state.selected.length > 0) {
                    btn.classList.add('answered-draft');
                }
            });
        }

        function saveCurrentSelection() {
            // Guarda la selección actual antes de cambiar de pregunta (si no está ya checkeada)
            if (!userAnswersState[currentQuestionIndex].isChecked) {
                const selectedOptions = optionsContainer.querySelectorAll('.option.selected');
                const userAnswers = Array.from(selectedOptions).map(opt => opt.textContent);
                userAnswersState[currentQuestionIndex].selected = userAnswers;
            }
        }

        function goToQuestion(index) {
            saveCurrentSelection();
            currentQuestionIndex = index;
            displayQuestion();
        }

        function displayQuestion() {
            updateNavStyles();
            
            const currentQuestion = shuffledQuestions[currentQuestionIndex];
            const currentState = userAnswersState[currentQuestionIndex];

            questionCounter.textContent = `Pregunta ${currentQuestionIndex + 1} de ${shuffledQuestions.length}`;
            questionText.textContent = currentQuestion.question;

            // Imagen
            const existingImage = document.getElementById('question-image');
            if (existingImage) existingImage.remove();
            if (currentQuestion.image) {
                const img = document.createElement('img');
                img.id = 'question-image';
                img.src = currentQuestion.image;
                img.alt = "Imagen de la pregunta";
                img.onerror = function() { this.style.display = 'none'; };
                questionText.insertAdjacentElement('afterend', img);
            }

            // Instrucción
            if (currentQuestion.answers.length > 1) {
                instructionText.textContent = "Selecciona todas las que apliquen.";
            } else {
                instructionText.textContent = "Selecciona una respuesta.";
            }

            // Opciones
            optionsContainer.innerHTML = '';
            // Si ya fue validada, deshabilitar
            if (currentState.isChecked) {
                optionsContainer.classList.add('disabled');
            } else {
                optionsContainer.classList.remove('disabled');
            }

            currentQuestion.options.forEach(option => {
                const optionElement = document.createElement('div');
                optionElement.classList.add('option');
                optionElement.textContent = option;
                
                // Restaurar selección guardada
                if (currentState.selected.includes(option)) {
                    optionElement.classList.add('selected');
                }

                // Si ya está validada, aplicar colores
                if (currentState.isChecked) {
                    if (currentQuestion.answers.includes(option)) {
                        optionElement.classList.add('correct');
                    } else if (currentState.selected.includes(option)) {
                        optionElement.classList.add('incorrect');
                    }
                }

                optionElement.addEventListener('click', () => {
                    if (!currentState.isChecked) {
                        selectOption(optionElement, currentQuestion.answers.length > 1);
                    }
                });
                optionsContainer.appendChild(optionElement);
            });

            // Explicación
            if (currentState.isChecked) {
                explanationText.textContent = currentQuestion.explanation;
                explanationArea.style.display = 'block';
                checkBtn.style.display = 'none'; // Ya validado
            } else {
                explanationArea.style.display = 'none';
                checkBtn.style.display = 'block'; // Mostrar botón verificar
            }

            // Botones de navegación
            prevBtn.disabled = (currentQuestionIndex === 0);
            
            // Lógica Botón Siguiente / Finalizar
            if (currentQuestionIndex === shuffledQuestions.length - 1) {
                nextBtn.style.display = 'none';
                finishBtn.style.display = 'block';
            } else {
                nextBtn.style.display = 'block';
                finishBtn.style.display = 'none';
            }
        }

        function selectOption(selectedElement, isMultiSelect) {
            if (optionsContainer.classList.contains('disabled')) return;
            if (!isMultiSelect) {
                const allOptions = optionsContainer.querySelectorAll('.option');
                allOptions.forEach(opt => opt.classList.remove('selected'));
            }
            selectedElement.classList.toggle('selected');
        }

        function checkAnswer() {
            const currentQuestion = shuffledQuestions[currentQuestionIndex];
            const selectedOptions = optionsContainer.querySelectorAll('.option.selected');
            
            if (selectedOptions.length === 0) {
                alert("Por favor, selecciona al menos una respuesta antes de verificar.");
                return;
            }

            const userAnswers = Array.from(selectedOptions).map(opt => opt.textContent);
            const correctAnswers = currentQuestion.answers;
            
            // Lógica de corrección
            let isCorrect = false;
            if (correctAnswers.length > 1) {
                let correctSelections = userAnswers.filter(answer => correctAnswers.includes(answer)).length;
                let incorrectSelections = userAnswers.length - correctSelections;
                if (incorrectSelections === 0 && correctSelections === correctAnswers.length) {
                    isCorrect = true;
                }
            } else {
                if (userAnswers.length === 1 && userAnswers[0] === correctAnswers[0]) {
                    isCorrect = true;
                }
            }

            // Actualizar estado
            userAnswersState[currentQuestionIndex].isChecked = true;
            userAnswersState[currentQuestionIndex].selected = userAnswers;
            userAnswersState[currentQuestionIndex].isCorrect = isCorrect;

            // Refrescar UI (mostrar colores, explicación, actualizar grid)
            displayQuestion(); 
        }

        function nextQuestion() {
            if (currentQuestionIndex < shuffledQuestions.length - 1) {
                goToQuestion(currentQuestionIndex + 1);
            }
        }

        function prevQuestion() {
            if (currentQuestionIndex > 0) {
                goToQuestion(currentQuestionIndex - 1);
            }
        }

        function showFinalScreen() {
            // Asegurarse de guardar la última selección si no se verificó
            saveCurrentSelection();

            questionArea.style.display = 'none';
            document.getElementById('controls').style.display = 'none';
            document.getElementById('question-nav-panel').style.display = 'none';
            finalScreen.style.display = 'block';

            // Calcular puntaje final
            let score = 0;
            userAnswersState.forEach(state => {
                if (state.isCorrect) score++;
            });

            const finalPercentage = (score / shuffledQuestions.length) * 100;
            finalScore.textContent = `Calificación Final: ${score} / ${shuffledQuestions.length} (${finalPercentage.toFixed(2)}%)`;

            resultsSummary.innerHTML = '';
            shuffledQuestions.forEach((q, index) => {
                const state = userAnswersState[index];
                const resultItem = document.createElement('div');
                resultItem.classList.add('result-item');

                let userAnswersHTML = state.selected.map(ua => {
                    const isCorrect = q.answers.includes(ua);
                    const className = isCorrect ? 'correct-choice' : 'incorrect-choice';
                    return `<span class="${className}">${ua}</span>`;
                }).join(', ');
                
                if (state.selected.length === 0) userAnswersHTML = "No se respondió";

                const points = state.isCorrect ? 1 : 0;

                resultItem.innerHTML = `
                    <p class="result-question">${index + 1}. ${q.question}</p>
                    <p class="user-answers"><strong>Tu respuesta:</strong> ${userAnswersHTML}</p>
                    <p class="correct-answers-summary"><strong>Respuesta correcta:</strong> ${q.answers.join(', ')}</p>
                    <p class="points">Puntos obtenidos: ${points.toFixed(2)} / 1.00</p>
                `;
                resultsSummary.appendChild(resultItem);
            });
        }

        checkBtn.addEventListener('click', checkAnswer);
        nextBtn.addEventListener('click', nextQuestion);
        prevBtn.addEventListener('click', prevQuestion);
        finishBtn.addEventListener('click', showFinalScreen);
        restartBtn.addEventListener('click', startQuiz);
        
        document.addEventListener('DOMContentLoaded', startQuiz);
    </script>
</body>
</html>